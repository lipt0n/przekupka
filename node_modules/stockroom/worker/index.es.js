import e from"unistore";function t(e,t){if(Array.isArray(e)){e=e.slice(0,t.length);for(var r=0;r<t.length;r++)void 0!==t[r]&&(e[r]=n(t[r],e[r]))}else for(var o in e=function(e,t){for(var n in t)e[n]=t[n];return e}({},e),t)t.hasOwnProperty(o)&&(void 0===t[o]?delete e[o]:e[o]=n(t[o],e[o]));return e}function n(e,n){return null!=n&&null!=e&&"object"==typeof n&&"object"==typeof e?t(n,e):e}function r(e,t){var n,r;if(Array.isArray(e))for(n=new Array(e.length),r=0;r<e.length;r++)e[r]!==t[r]&&(n[r]=o(e[r],t[r]));else for(r in n={},e)e.hasOwnProperty(r)&&e[r]!==t[r]&&(n[r]=o(e[r],t[r]));return n}function o(e,t){return"object"==typeof e&&"object"==typeof t?r(e,t):e}export default function(n){var o=e(n),i=o.actions={},a={},f=0,u=[],p=[];for(var s in n)a[s]=n[s];function c(e){1===p.push(e)&&setTimeout(l)}function l(){"function"==typeof postMessage&&postMessage(p),p.length=0}function y(e){if(f>0)return u.push(e);var n=e.type,r=e.id,a=e.overwrite,p=e.update,s=e.action;if("@@STATE"===n)!0===e.partial&&(p=t(o.getState(),p),a=!0),o.setState(p,!0===a,s);else if("@@ACTION"===n){var l=i[s.type];s.params?l.apply(i,s.params):l.call(i,s.payload),r&&c({type:"@@ACTIONCOMPLETE",id:r})}}return"function"==typeof addEventListener&&addEventListener("message",function(e){var t=e.data;if("object"!=typeof t);else if("pop"in t)if(1===t.length)y(t[0]);else for(var n=0;n<t.length;n++)y(t[n]);else y(t)}),o.subscribe(function(e,t){var n=r(e,a);a=e,c({type:"@@STATE",update:n,action:t&&t.name,partial:!0})}),o.registerActions=function(e){for(var t in"function"==typeof e&&(e=e(o)),e)i[t]=o.action(e[t])},o.freeze=function(){f++},o.unfreeze=function(){if(!--f){var e=u;u=[];for(var t=0;t<e.length;t++)y(e[t])}},c({type:"@@STATE",initial:!0,update:o.getState()}),o};
//# sourceMappingURL=index.es.js.map
